<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Cell type annotation and initial QC — taxonomy_mapping • scrattch.mapping</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Cell type annotation and initial QC — taxonomy_mapping"><meta property="og:description" content="This function performs mapping using four methods (Correlation-based, tree-based, heirarchical, and Seurat-based) and will return the top one (or in some cases more) best matching reference cell type along with some associated QC metrics."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">scrattch.mapping</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/go_to_examples.html">Go to examples</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Cell type annotation and initial QC</h1>

    <div class="hidden name"><code>taxonomy_mapping.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function performs mapping using four methods (Correlation-based, tree-based, heirarchical, and Seurat-based) and will return the top one (or in some cases more) best matching reference cell type along with some associated QC metrics.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">taxonomy_mapping</span><span class="op">(</span></span>
<span>  <span class="va">AIT.anndata</span>,</span>
<span>  <span class="va">query.data</span>,</span>
<span>  corr.map <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  tree.map <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  mapmycells.hierarchical.map <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  mapmycells.flat.map <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seurat.map <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  label.cols <span class="op">=</span> <span class="va">AIT.anndata</span><span class="op">$</span><span class="va">uns</span><span class="op">$</span><span class="va">hierarchy</span>,</span>
<span>  genes.to.use <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"highly_variable_genes_"</span>, <span class="va">AIT.anndata</span><span class="op">$</span><span class="va">uns</span><span class="op">$</span><span class="va">mode</span><span class="op">)</span>,</span>
<span>  mapmycells_params_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-ait-anndata">AIT.anndata<a class="anchor" aria-label="anchor" href="#arg-ait-anndata"></a></dt>
<dd><p>A reference taxonomy object.</p></dd>


<dt id="arg-query-data">query.data<a class="anchor" aria-label="anchor" href="#arg-query-data"></a></dt>
<dd><p>A logCPM normalized matrix to be annotated.</p></dd>


<dt id="arg-corr-map">corr.map<a class="anchor" aria-label="anchor" href="#arg-corr-map"></a></dt>
<dd><p>Should correlation mapping be performed? (see methods)</p></dd>


<dt id="arg-tree-map">tree.map<a class="anchor" aria-label="anchor" href="#arg-tree-map"></a></dt>
<dd><p>Should tree mapping be performed? (see methods)</p></dd>


<dt id="arg-mapmycells-hierarchical-map">mapmycells.hierarchical.map<a class="anchor" aria-label="anchor" href="#arg-mapmycells-hierarchical-map"></a></dt>
<dd><p>Should mapmycells' hierarchical mapping be performed? (see methods)</p></dd>


<dt id="arg-mapmycells-flat-map">mapmycells.flat.map<a class="anchor" aria-label="anchor" href="#arg-mapmycells-flat-map"></a></dt>
<dd><p>Should mapmycells' flat mapping be performed? (see methods)</p></dd>


<dt id="arg-seurat-map">seurat.map<a class="anchor" aria-label="anchor" href="#arg-seurat-map"></a></dt>
<dd><p>Should seurat mapping be performed? (see methods)</p></dd>


<dt id="arg-label-cols">label.cols<a class="anchor" aria-label="anchor" href="#arg-label-cols"></a></dt>
<dd><p>Column names of annotations to map against.  Note that this only works for metadata that represent clusters or groups of clusters (e.g., subclass, supertype, neighborhood, class) and will default to whatever is included in AIT.anndata$uns$hierarchy. This is highly related to the variable called "hierarchy" in other functions.</p></dd>


<dt id="arg-genes-to-use">genes.to.use<a class="anchor" aria-label="anchor" href="#arg-genes-to-use"></a></dt>
<dd><p>The set of genes to use for correlation calculation and/or Seurat integration (default is the highly_variable_genes associated with the current mode). Can be (1) a character vector of gene names, (2) a TRUE/FALSE (logical) vector of which genes to include, or (3) a column name in AIT.anndata$var corresponding to a logical vector of variable genes.</p>
<p>Mapping methods currently available in <code>taxonomy_mapping</code> include:</p><ol><li><p><strong>corr.map</strong>: This method calculates the Pearson correlation between each cell and each cluster median, and returns the cluster with the highest correlation along with the associated correlation score. Despite being a very simple method, this works quite well in some circumstances.</p></li>
<li><p><strong>tree.map</strong>: Historical implementation of tree mapping used for assigning cell types to patch-seq cells in several studies of mouse visual cortex. This method requires a dendogram and iteratively walks down the tree from the root node to the leave nodes deciding the most likely cell type based on a distict set of marker genes at each node. By subsampling genes, this method provides a bootstrapping probability/confidence. <em>Implementation of tree mapping herein is not fully tested, so use with caution.</em></p></li>
<li><p><strong>mapmycells.hierarchical.map</strong>: Current version of iterative (or hierarchical) mapping used in MapMyCells, this function imports the python <code>cell_type_mapper</code> library. It requires a leveled hierarchy (e.g., cluster columns corresponding to cell type definitions at different levels of resolutions such as "cluster" and "subclass" and "class") and performs correlation-based mapping with different marker genes for each level, iterating through the levels similar to tree mapping. Like tree mapping this method provides a bootstrapping probability/confidence by subsampling genes. We find that this method works quite well in some circumstances.</p></li>
<li><p><strong>mapmycells.flat.map</strong>: A single-level implementation of hierarchical mapping. Essentially it is the same as corr.map, except that it uses a prespecified set of marker genes for calculating the correlation and that it outputs bootstrapping probabilities.</p></li>
<li><p><strong>seurat.map</strong>: Historical implementation of Seurat mapping for assigning cell types to patch-seq cells in a study of human temporal cortex. This method performs integration and label transfer using <code>FindTransferAnchors</code> and <code>TransferData</code> functions in Seurat (v4.4.0) with a prespecified set of variable genes and a reasonable set of parameters. <em>We are not maintaining this method for compatibility in Seurat versions 5.0 or higher, and therefore this function will likely fail outside of the Docker environment.</em></p></li>
</ol></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>Mapping results from all methods.</p>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Changkyu Lee.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

